<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Ticket</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
</head>

<body>
  <div class="menu">
    <div class="nav-menu">
      <div class="option"><a href="/tickets">Tickets</a></div>
      <div class="divider option-selected">/</div>
      <div class="option option-selected" id="ticket-id">N/A</div>
      <div class="divider">|</div>
      <div class="option"><a href="/admin">Admin</a></div>
    </div>
    <div id="login-menu" class="login-menu"></div>
  </div>

  <div class="content">
    <table id="ticket-info">
      <tr>
        <th><label for="customer">Customer</label></th>
        <td>
          <div id="customer"></div>
        </td>
      </tr>
      <tr>
        <th><label for="last_updated">Last Updated</label></th>
        <td>
          <div id="last_updated"></div>
        </td>
      </tr>
      <tr>
        <th><label for="description">Description</label></th>
        <td>
          <div id="description"></div>
        </td>
      </tr>
      <tr>
        <th><label for="resolved">Resolved</label></th>
        <td>
          <div id="resolved"></div>
        </td>
      </tr>
    </table>
    <button id="ticket-resolve-button" onclick="toggleResolved()" />
  </div>

  <script src="/scripts/login.js"></script>
  <script>

    const parts = location.pathname.split('/')
    const id = parts[parts.length-1]
    document.getElementById('ticket-id').textContent = id

    async function displayTicket() {

      const ticket = await fetch(`/api/tickets/${id}`).then(x => x.json())
      document.getElementById('customer').textContent = ticket.customer
      document.getElementById('last_updated').textContent = ticket.last_updated
      document.getElementById('description').textContent = ticket.description
      document.getElementById('resolved').textContent = ticket.resolved ? "yes" : "no"

      if (ticket.resolved) {
        document.getElementById('ticket-resolve-button').textContent = "Unresolve"
      } else {
        document.getElementById('ticket-resolve-button').textContent = "Resolve"
      }
    }

    async function toggleResolved() {
      const resolved = document.getElementById('ticket-resolve-button').textContent === "Resolve"

      await fetch(`/api/tickets/${id}/resolve`, {
        method: 'POST',
        headers: {'content-type': 'application/json'},
        body: JSON.stringify({resolved: resolved})})

        window.location.reload()
    }

    displayTicket()
  </script>
</body>

</html>